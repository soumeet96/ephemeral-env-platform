<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Ephemeral Application Deployer</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 40px;
      max-width: 500px;
      margin: auto;
    }
    input, button {
      padding: 10px;
      margin-top: 10px;
      width: 100%;
      font-size: 16px;
    }
    .success, .error {
      margin-top: 20px;
      font-weight: bold;
    }
    .success {
      color: green;
    }
    .error {
      color: red;
    }
  </style>
</head>
<body>

<h2>Trigger Ephemeral Application</h2>

<form id="triggerForm">
  <label>GitHub Repository (owner/repo):</label>
  <input type="text" id="repo" placeholder="e.g. soumeet96/ephemeral-env-platform" required>

  <label>Branch Name:</label>
  <input type="text" id="branch" placeholder="e.g. feature/my-test-branch" required>

  <label>GitHub Token:</label>
  <input type="password" id="token" placeholder="GitHub PAT with workflow access" required>

  <button type="submit">Trigger Deployment</button>
</form>

<div id="response" class="success" style="display: none;"></div>
<div id="error" class="error" style="display: none;"></div>

<script>
document.getElementById('triggerForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  const repo = document.getElementById('repo').value;
  const branch = document.getElementById('branch').value;
  const token = document.getElementById('token').value;

  const [owner, repoName] = repo.split('/');
  const responseDiv = document.getElementById('response');
  const errorDiv = document.getElementById('error');
  responseDiv.style.display = 'none';
  errorDiv.style.display = 'none';

  try {
    const res = await fetch(`https://api.github.com/repos/soumeet96/ephemeral-env-platform/actions/workflows/deploy.yml/dispatches`, {
      method: 'POST',
      headers: {
        'Authorization': `token ${token}`,
        'Accept': 'application/vnd.github+json'
      },
      body: JSON.stringify({
        ref: branch
      })
    });

    if (res.status === 204) {
      responseDiv.textContent = 'Deployment workflow triggered successfully!';
      responseDiv.style.display = 'block';
    } else {
      const error = await res.json();
      throw new Error(error.message || 'Failed to trigger deployment');
    }
  } catch (err) {
    errorDiv.textContent = `Error: ${err.message}`;
    errorDiv.style.display = 'block';
  }
});
</script>

</body>
</html>
